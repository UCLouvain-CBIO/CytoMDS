<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Low Dimensional Projection of Cytometry Samples • CytoMDS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Low Dimensional Projection of Cytometry Samples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CytoMDS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/CytoMDS.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UCLouvain-CBIO/CytoMDS/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Low Dimensional Projection of Cytometry Samples</h1>
                        <h4 data-toc-skip class="author">Philippe
Hauchamps</h4>
                                    <h4 data-toc-skip class="author">Laurent
Gatto</h4>
                        
      
      <small class="dont-index">Source: <a href="https://github.com/UCLouvain-CBIO/CytoMDS/blob/main/vignettes/CytoMDS.Rmd" class="external-link"><code>vignettes/CytoMDS.Rmd</code></a></small>
      <div class="d-none name"><code>CytoMDS.Rmd</code></div>
    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>This vignette describes the functionality implemented in the
      <code>CytoMDS</code> package. <code>CytoMDS</code> provides
      support for low dimensional projection of a set of cytometry
      samples, using concepts such as Earth Mover’s (EMD) distance, and
      Multi Dimensional Scaling (MDS). This vignette is distributed
      under a CC BY-SA 4.0 license.</p>
    </div>
    
<div class="section level2">
<h2 id="installation-and-loading-dependencies">Installation and loading dependencies<a class="anchor" aria-label="anchor" href="#installation-and-loading-dependencies"></a>
</h2>
<p>To install this package, start R and enter (un-commented):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># if (!require("BiocManager", quietly = TRUE))</span></span>
<span><span class="co">#     install.packages("BiocManager")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># BiocManager::install("CytoMDS")</span></span></code></pre></div>
<p>We now load the packages needed in the current vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lmweber/HDCytoData" class="external-link">HDCytoData</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://uclouvain-cbio.github.io/CytoMDS">CytoMDS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>CytoMDS</code> package implements low dimensional
visualization of cytometry samples, in order to visually assess
distances between them. This, in turn, can greatly help the user to
identify quality issues like batch effects or outlier samples, and/or
check the presence of potential sample clusters that might align with
the experimental design.</p>
<p>The <code>CytoMDS</code> algorithm combines, on the one hand, the
concept of <em>Earth Mover’s Distance (EMD)</em> <span class="citation">(Orlova et al. 2016)</span>, a.k.a. <em>Wasserstein
metric</em> and, on the other hand, the metric <em>Multi Dimensional
Scaling (MDS)</em> algorithm for the low dimensional projection <span class="citation">(Leeuw and Mair 2009)</span>.</p>
<p>Besides projection itself, the package also provides some diagnostic
tools for both checking the quality of the MDS projection, as well as
interpreting the axes of the projection (see below sections).</p>
</div>
<div class="section level2">
<h2 id="illustrative-dataset">Illustrative dataset<a class="anchor" aria-label="anchor" href="#illustrative-dataset"></a>
</h2>
<p>The illustrative dataset that is used throughout this vignette is a
mass cytometry (<em>CyTOF</em>) dataset from <span class="citation">(Bodenmiller et al. 2012)</span>, and provided in the
Bioconductor <em>HDCytoData</em> data package (<span class="citation">Weber and Soneson (2019)</span>).</p>
<p>This dataset consists of 16 paired samples (8 times 2) of peripheral
blood cells from healthy individuals. Among each sample pair, one sample
- the reference - was left un-stimulated, while the other sample was
stimulated with B cell receptor / Fc receptor cross-linker (BCR-XL).</p>
<p>This public dataset is known to contain a strong differential
expression signal between the two conditions (stimulated vs
un-stimulated) and as been used in recent work to benchmark differential
analysis algorithms (<span class="citation">(Weber et al. 2019)</span>)
and to design mass cytometry data analysis pipelines (<span class="citation">(Nowicka et al. 2017)</span>).</p>
<p>In the <code>CytoMDS</code>package, as in the current vignette,
matrices of cytometry events intensities, corresponding to one sample,
are stored as <code><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html" class="external-link">flowCore::flowFrame</a></code> <span class="citation">(Ellis et al. 2023)</span> objects. Samples of a
particular cytometry dataset are then stored as a
<code><a href="https://rdrr.io/pkg/flowCore/man/flowSet-class.html" class="external-link">flowCore::flowSet</a></code> object, which is a collection of
flowFrame’s, i.e. one flowFrame per sample. Therefore, we load the
flowSet version of the <em>BodenMiller2012</em> dataset, obtained from
the <code>HDCytoData</code> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BCRXL_fs</span> <span class="op">&lt;-</span> <span class="fu">HDCytoData</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/HDCytoData/man/Bodenmiller_BCR_XL_SE.html" class="external-link">Bodenmiller_BCR_XL_flowSet</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## see ?HDCytoData and browseVignettes('HDCytoData') for documentation</span></span></code></pre>
<pre><code><span><span class="co">## loading from cache</span></span></code></pre>
<pre><code><span><span class="co">## Warning in updateObjectFromSlots(object, ..., verbose = verbose): dropping</span></span>
<span><span class="co">## slot(s) 'colnames' from object = 'flowSet'</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BCRXL_fs</span></span></code></pre></div>
<pre><code><span><span class="co">## A flowSet with 16 experiments.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## column names(39): Time Cell_length ... sample_id population_id</span></span></code></pre>
<p>In regular flowSet’s, the experimental design information is
typically<br>
stored in the <code>phenoData</code> slot, and this is also the way
<code>CytoMDS</code> expects to get its input. However,
<code>HDCytoData</code> has chosen to store the experimental design
information in a slightly different way, hence the need to convert the
data as follows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenoData</span> <span class="op">&lt;-</span> <span class="fu">flowCore</span><span class="fu">::</span><span class="fu">pData</span><span class="op">(</span><span class="va">BCRXL_fs</span><span class="op">)</span></span>
<span><span class="va">additionalPhenoData</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/keyword-methods.html" class="external-link">keyword</a></span><span class="op">(</span><span class="va">BCRXL_fs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"EXPERIMENT_INFO"</span><span class="op">)</span><span class="op">$</span><span class="va">EXPERIMENT_INFO</span></span>
<span><span class="va">phenoData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">phenoData</span>, <span class="va">additionalPhenoData</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">flowCore</span><span class="fu">::</span><span class="fu">pData</span><span class="op">(</span><span class="va">BCRXL_fs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">phenoData</span></span></code></pre></div>
<p>We also select channels/markers that are biologically relevant,
i.e. both the cell type and cell state markers, and store them for
further use. We discard the typical housekeeping markers that are founds
in flowFrames like <em>time</em> and Cell_length, etc. In total, these
mass cytometry samples contain intensities for 24 biologically relevant
markers.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">markerInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/keyword-methods.html" class="external-link">keyword</a></span><span class="op">(</span><span class="va">BCRXL_fs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"MARKER_INFO"</span><span class="op">)</span><span class="op">$</span><span class="va">MARKER_INFO</span></span>
<span><span class="va">chClass</span> <span class="op">&lt;-</span> <span class="va">markerInfo</span><span class="op">$</span><span class="va">marker_class</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">chClass</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## chClass</span></span>
<span><span class="co">##  none  type state </span></span>
<span><span class="co">##    11    10    14</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chLabels</span> <span class="op">&lt;-</span> <span class="va">markerInfo</span><span class="op">$</span><span class="va">channel_name</span><span class="op">[</span><span class="va">chClass</span> <span class="op">!=</span> <span class="st">"none"</span><span class="op">]</span></span>
<span><span class="op">(</span><span class="va">chMarkers</span> <span class="op">&lt;-</span> <span class="va">markerInfo</span><span class="op">$</span><span class="va">marker_name</span><span class="op">[</span><span class="va">chClass</span> <span class="op">!=</span> <span class="st">"none"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "CD3"    "CD45"   "pNFkB"  "pp38"   "CD4"    "CD20"   "CD33"   "pStat5"</span></span>
<span><span class="co">##  [9] "CD123"  "pAkt"   "pStat1" "pSHP2"  "pZap70" "pStat3" "CD14"   "pSlp76"</span></span>
<span><span class="co">## [17] "pBtk"   "pPlcg2" "pErk"   "pLat"   "IgM"    "pS6"    "HLA-DR" "CD7"</span></span></code></pre>
<p>The first step consists in scale transforming the raw data. Indeed,
distances between samples make more sense with scaled transformed
signal, in which distributional differences are more readable and usable
for downstream analysis.</p>
<p>Here, since we are dealing with mass cytometry samples, we use the
classical <code>arcsinh()</code> transformation with 5 as
<em>co-factor</em>, as described elsewhere (<span class="citation">(Nowicka et al. 2017)</span>).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/arcsinhTransform.html" class="external-link">arcsinhTransform</a></span><span class="op">(</span></span>
<span>    transformationId<span class="op">=</span><span class="st">"ArcsinhTransform"</span>, </span>
<span>    a <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    b <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">5</span>, </span>
<span>    c <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">BCRXL_fs_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transform.html" class="external-link">transform</a></span><span class="op">(</span></span>
<span>    <span class="va">BCRXL_fs</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transformList-class.html" class="external-link">transformList</a></span><span class="op">(</span><span class="va">chLabels</span>, <span class="va">trans</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculating-distances-between-samples">Calculating distances between samples<a class="anchor" aria-label="anchor" href="#calculating-distances-between-samples"></a>
</h2>
<p>We can now calculate pairwise <em>Earth Mover’s Distances (EMD)</em>
between all samples of our dataset.</p>
<p>This is done by calling the <code><a href="../reference/pairwiseEMDDist.html">pairwiseEMDDist()</a></code> method The
simplest way to<br>
use this method is by providing directly a
<code><a href="https://rdrr.io/pkg/flowCore/man/flowSet-class.html" class="external-link">flowCore::flowSet</a></code>, containing all samples, as input
parameter. Note that, for heavy datasets that include a lot of samples,
this can create memory issues. To handle this case, <code>CytoMDS</code>
provides other ways to call the <code><a href="../reference/pairwiseEMDDist.html">pairwiseEMDDist()</a></code> function
(see ‘Handling heavy datasets’ section).</p>
<p>Using the <code>channels</code> argument, it is possible to restrict
the EMD calculation to some of the channels. Here we simply pass as
input the biologically relevant markers selected in the previous
section.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwDist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pairwiseEMDDist.html">pairwiseEMDDist</a></span><span class="op">(</span></span>
<span>    <span class="va">BCRXL_fs_trans</span>,</span>
<span>    channels <span class="op">=</span> <span class="va">chMarkers</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The calculated distance is a symmetric square matrix, with as many
rows (columns) as input samples (extract shown here below for the
scale-transformed <em>Bodenmiller2012</em> dataset).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pwDist</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        1     2     3     4     5     6     7     8     9    10</span></span>
<span><span class="co">## 1   0.00 10.46  4.30 11.18  6.39 12.69  7.11 11.85  5.88 10.13</span></span>
<span><span class="co">## 2  10.46  0.00 10.91  3.16 11.45  6.06 13.17 10.61  9.61  6.08</span></span>
<span><span class="co">## 3   4.30 10.91  0.00 10.72  7.44 13.17  7.47 12.84  5.84 10.00</span></span>
<span><span class="co">## 4  11.18  3.16 10.72  0.00 12.10  5.97 12.66  9.63 10.35  6.72</span></span>
<span><span class="co">## 5   6.39 11.45  7.44 12.10  0.00  9.19  4.45 10.19  5.28  9.96</span></span>
<span><span class="co">## 6  12.69  6.06 13.17  5.97  9.19  0.00 10.56  7.23 11.61  7.74</span></span>
<span><span class="co">## 7   7.11 13.17  7.47 12.66  4.45 10.56  0.00  7.24  8.89 11.87</span></span>
<span><span class="co">## 8  11.85 10.61 12.84  9.63 10.19  7.23  7.24  0.00 14.50 11.68</span></span>
<span><span class="co">## 9   5.88  9.61  5.84 10.35  5.28 11.61  8.89 14.50  0.00  7.10</span></span>
<span><span class="co">## 10 10.13  6.08 10.00  6.72  9.96  7.74 11.87 11.68  7.10  0.00</span></span></code></pre>
<p>One relevant way to visualize this distance matrix is to draw the
histogram of pairwise distances, as shown in the below plot.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distVec</span> <span class="op">&lt;-</span> <span class="va">pwDist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">pwDist</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">distVecDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">distVec</span><span class="op">)</span></span>
<span><span class="va">pHist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">distVecDF</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkgrey"</span>, col <span class="op">=</span> <span class="st">"black"</span>, bins <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"EMD distances for Bodenmiller2012 dataset"</span><span class="op">)</span></span>
<span><span class="va">pHist</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/distShowHist-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="metric-multidimensional-scaling">Metric Multidimensional scaling<a class="anchor" aria-label="anchor" href="#metric-multidimensional-scaling"></a>
</h2>
<div class="section level3">
<h3 id="calculating-the-mds-projection">Calculating the MDS projection<a class="anchor" aria-label="anchor" href="#calculating-the-mds-projection"></a>
</h3>
<p>Once the pairwise distance matrix has been calculated, computing the
<em>Multi Dimensional Scaling (MDS)</em> projection is done by calling
the <code><a href="../reference/computeMetricMDS.html">computeMetricMDS()</a></code> function. In its simplest form, only
the distance matrix needs to be passed to the function. In that case,
the number of dimensions to use in the MDS is automatically set in order
to reach a specific value for a projection quality indicator, i.e. the
<em>target pseudo R square</em>, which in turn is set by default to 0.95
(see Quality of projection - diagnostic tools section).</p>
<p>Note that the <em>Smacof</em> algorithm <span class="citation">(Leeuw
and Mair 2009)</span>, used to compute the MDS projection, is
stochastic, so it is sensitive to the ‘seed’ used. Therefore, in cases
where reproducible results from one run to another is required, it is
advised to set the <code>seed</code> argument to a fixed value.</p>
<p>The returned value of the <code><a href="../reference/computeMetricMDS.html">computeMetricMDS()</a></code> function is
an object of the <em>MDS</em> class. This object can be queried to get
e.g. the number of dimensions that was effectively used, or the obtained
pseudo RSquare, as shown in the following code chunk:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mdsObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeMetricMDS.html">computeMetricMDS</a></span><span class="op">(</span><span class="va">pwDist</span>, seed <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">mdsObj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## MDS object containing MDS projection (using Smacof algorithm)  data:</span></span>
<span><span class="co">## Nb of dimensions:  4 </span></span>
<span><span class="co">## Nb of points:  16 </span></span>
<span><span class="co">## Stress:  0.040668 </span></span>
<span><span class="co">## Pseudo RSquare:  0.981489 </span></span>
<span><span class="co">## Goodness of fit:  0.998346</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="plotting-the-mds-projection">Plotting the MDS projection<a class="anchor" aria-label="anchor" href="#plotting-the-mds-projection"></a>
</h3>
<p>Plotting the obtained MDS projection is done using
<code><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS()</a></code>. If no <code>phenoData</code> parameter
is passed, then, by default, numbers are used as labels, and samples are
represented as black dots.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS</a></span><span class="op">(</span><span class="va">mdsObj</span><span class="op">)</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMDS1_simplest-1.png" width="700" style="display: block; margin: auto;"></p>
<p>However, by providing a ‘phenoData’ dataframe to the
<code><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS()</a></code> function, the corresponding variables can
be used for highlighting sample points with different colours and/or
shapes. Here below, the previous plot is enhanced with red and blue
colours, distinguishing samples from the two conditions. Also, we have
added more meaningful labels to each data point, corresponding to
patient id’s.</p>
<p>On this plot, one can clearly see a clear separation between samples
of the two different conditions. These 2 sample groups are different
along the x axis, which corresponds to the first projection direction,
explaining 46.69 % of the variability contained in the MDS projection
with 4 dimensions (as indicated in the subtitle). This clear separation
between 2 condition clusters highlights the strong biological signal
differentiating these two groups of samples. Further in this vignette,
we shall try to assign a user interpretation to this x axis direction
(see ‘Aid to interpreting projection axes’ section).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p12</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS</a></span><span class="op">(</span></span>
<span>    <span class="va">mdsObj</span>,</span>
<span>    pData <span class="op">=</span> <span class="va">phenoData</span>,</span>
<span>    projectionAxes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    pDataForColour <span class="op">=</span> <span class="st">"group_id"</span>,</span>
<span>    pDataForLabel <span class="op">=</span> <span class="st">"patient_id"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p12</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMDS_colours_shapes_1_2-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Given that 4 dimensions were used in the metric MDS algorithm, the
user can visualize the MDS projection using any combination of two axes,
for example axes 2 and 3n or 3 and 4, as below:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p23</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS</a></span><span class="op">(</span></span>
<span>    <span class="va">mdsObj</span>,</span>
<span>    pData <span class="op">=</span> <span class="va">phenoData</span>,</span>
<span>    projectionAxes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>    pDataForColour <span class="op">=</span> <span class="st">"group_id"</span>,</span>
<span>    pDataForLabel <span class="op">=</span> <span class="st">"patient_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p34</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS</a></span><span class="op">(</span></span>
<span>    <span class="va">mdsObj</span>,</span>
<span>    pData <span class="op">=</span> <span class="va">phenoData</span>,</span>
<span>    projectionAxes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>    pDataForColour <span class="op">=</span> <span class="st">"group_id"</span>,</span>
<span>    pDataForLabel <span class="op">=</span> <span class="st">"patient_id"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p23</span> <span class="op">/</span> <span class="va">p34</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMDS_colours_shapes_2_3_4-1.png" width="864" style="display: block; margin: auto;"></p>
<p>These plots reveal two important findings: 1. Dots of the 2 samples
groups are well-mixed in both views, showing that the biological
difference between the two sample groups is mainly concentrated along
the first projection axis. 2. Dots corresponding to samples from the
same patient id are most of the time very close to each other. We could
conclude that the variability contained in axes 2, 3 and 4 mostly
represent biological variation between different individuals, and not
(or much less) the effect of stimulation.</p>
</div>
<div class="section level3">
<h3 id="quality-of-projection---diagnostic-tools">Quality of projection - diagnostic tools<a class="anchor" aria-label="anchor" href="#quality-of-projection---diagnostic-tools"></a>
</h3>
<p>In order to be able to trust the projected distances obtained on the
<code>CytoMDS</code> plots, a couple of projection quality indicators
can be verified : - the <em>pseudo RSquare</em> indicator shows what
percentage of the variability contained in the pairwise distance matrix
is actually contained in the low dimensional MDS projection. It is
analog to the statistical <em>RSquare</em> for a linear regression
model, i.e. the closer to one the <em>pseudo RSquare</em> is, the
better. Note that the <em>pseudo RSquare</em> refers to the variability
contained in <strong>ALL</strong> dimensions of the MDS projection, not
only the two plotted axes. - <em>nDim</em> is the number of dimensions
of the projection that was needed to obtain the corresponding <em>pseudo
RSquare</em> (here 4 dimensions). - the percentage of variation that is
captured along each axis (coordinates), is to be interpreted with
respect to the total variability <strong>that is captured by the MDS
projection</strong>, not the total variability.</p>
<p>For example, in the previous section, the MDS projection using 4
dimensions is able to capture 98.15% (<em>pseudo RSquare</em>) of the
initial variability contained in the calculated pairwise distance
matrix. <strong>Of these 98.15%</strong>, 46.69% is in turn captured by
axis 1, 29.95% is captured by axis 2, 15.38% is captured by axis 3 and
7.99% is captured by axis 4.</p>
<p>Another useful projection quality diagnostic tool is the <em>Shepard
diagram</em>. On this diagram, each dot represents a single distance
between a sample pair, with as x coordinate the original (high
dimensional) distance between the two samples, and as y coordinate the
projected low dimensional distance, as obtained by the MDS projection
algorithm.</p>
<p>In the <em>Shepard</em> diagram, the ideal situation is when all dots
are located on a straight line passing through the (0,0) and (1,1)
points. In the below diagram, one can notice that all points are very
near the ideal straight line, hence the distance projections can be
trusted.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplotSampleMDSShepard.html">ggplotSampleMDSShepard</a></span><span class="op">(</span><span class="va">mdsObj</span><span class="op">)</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMDSShepard-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="additional-options-for-the-mds-projection">Additional options for the MDS projection<a class="anchor" aria-label="anchor" href="#additional-options-for-the-mds-projection"></a>
</h3>
<p>In this section, we describe a couple of additional options available
to the user when calculating the MDS projection using
<code><a href="../reference/computeMetricMDS.html">computeMetricMDS()</a></code>.</p>
<p>First, instead of letting the algorithm choose itself the number of
dimensions, it is also possible to assign it explicitly, for example to
2, as in below:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">mdsObj2</span> <span class="op">&lt;-</span> <span class="fu">CytoMDS</span><span class="fu">::</span><span class="fu"><a href="../reference/computeMetricMDS.html">computeMetricMDS</a></span><span class="op">(</span><span class="va">pwDist</span>, seed <span class="op">=</span> <span class="fl">0</span>, nDim <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS</a></span><span class="op">(</span><span class="va">mdsObj2</span>,</span>
<span>                 pData <span class="op">=</span> <span class="va">phenoData</span>,</span>
<span>                 projectionAxes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                 pDataForColour <span class="op">=</span> <span class="st">"group_id"</span>,</span>
<span>                 pDataForLabel <span class="op">=</span> <span class="st">"patient_id"</span>,</span>
<span>                 flipYAxis <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/MDSCalc.nDim2-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Note that the obtained projection on 2 axes, although similar, is not
exactly the same as the one obtained when visualizing the first two axis
of the MDS projection obtained before, with 4 dimensions. Actually, this
is a feature of the Metric MDS projection, although it might appear a
bit counter-intuitive at first.</p>
<p>Second, it is also possible to adjust the number of dimensions
indirectly, by setting an explicit <em>pseudo Rsquare</em> target. In
that case the algorithm will increase the number of dimensions until
reaching the required quality target, instead of the by default 0.95
target.</p>
<p>The below example shows how to obtain a <em>pseudo R Square</em> of
at least 0.99. As a result, the needed number of dimensions is now 6,
instead of 4.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mdsObj3</span> <span class="op">&lt;-</span> <span class="fu">CytoMDS</span><span class="fu">::</span><span class="fu"><a href="../reference/computeMetricMDS.html">computeMetricMDS</a></span><span class="op">(</span><span class="va">pwDist</span>, seed <span class="op">=</span> <span class="fl">0</span>, targetPseudoRSq <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS</a></span><span class="op">(</span><span class="va">mdsObj3</span>,</span>
<span>                 pData <span class="op">=</span> <span class="va">phenoData</span>,</span>
<span>                 projectionAxes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                 pDataForColour <span class="op">=</span> <span class="st">"group_id"</span>,</span>
<span>                 pDataForLabel <span class="op">=</span> <span class="st">"patient_id"</span><span class="op">)</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/MDSCalc.Rsq99-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The corresponding Shepard diagram is obtained as below, showing that
the dots are even more concentrated around the ideal straight line, than
before:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplotSampleMDSShepard.html">ggplotSampleMDSShepard</a></span><span class="op">(</span><span class="va">mdsObj3</span><span class="op">)</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMDSShepard.Rsq99-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="aid-to-interpreting-projection-axes">Aid to interpreting projection axes<a class="anchor" aria-label="anchor" href="#aid-to-interpreting-projection-axes"></a>
</h3>
<div class="section level4">
<h4 id="bi-plots">Bi-plots<a class="anchor" aria-label="anchor" href="#bi-plots"></a>
</h4>
<p>With MDS projections, it is possible to (try to) associate some axis
directions to specific sample characteristics. The idea is to calculate
the correlation of well chosen sample statistics w.r.t. the axes of
projection, so that these correlations can be represented on a
correlation circle, which is overlaid on the projection plot. This plot
set-up is called a ‘bi-plot’.</p>
<p>In order produce a bi=plot, the user first needs to calculate chosen
statistics of interest for which they want to assess the association
with the axis directions. Typically, one chooses channel specific
statistics, like e.g. the mean, the standard deviation, or any quantile
that might be of interest. However, any statistics that can be
calculated for each sample can be used (number of events,…)</p>
<p>Here below, we provide an example where the user overlays the median
of the different channels, on a bi-plot with MDS projection axes 1 and
2.</p>
<p>On the bi-plot, each arrow - here representing a channel median - is
located at coordinates equal to its respective Pearson correlation
w.r.t. the two axis.</p>
<p>Here, one can identify that the x axis has a strong positive
correlation with the median of markers ‘CD4’, ‘CD33’, ‘CD20’, ‘pNFkB’,
‘pp38’, ‘pBtk’ and ‘pSlp76’, and a strong negative correlation with the
median of marker ‘HLA-DR’. The y axis has a strong negative correlation
with the median of a number of markers: ‘CD123’, ‘pStat1’, ‘pStat5’,
‘pSHP2’, ‘pAkt’, ‘pZap70’ and ‘pPlcg2’.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medians</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/channelSummaryStats.html">channelSummaryStats</a></span><span class="op">(</span><span class="va">BCRXL_fs_trans</span>, </span>
<span>                               channels <span class="op">=</span> <span class="va">chLabels</span>, </span>
<span>                               statFUNs <span class="op">=</span> <span class="va">median</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS</a></span><span class="op">(</span><span class="va">mdsObj</span>,</span>
<span>                pData <span class="op">=</span> <span class="va">phenoData</span>,</span>
<span>                pDataForColour <span class="op">=</span> <span class="st">"group_id"</span>,</span>
<span>                displayPointLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                displayArrowLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                repelArrowLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                biplot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                extVariables <span class="op">=</span> <span class="va">medians</span><span class="op">)</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMDS_biplot-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Note that, on the bi-plots, only the arrows of length greater or
equal to a specific threshold (by default set at 0.8) are represented,
in order to not overwhelm the plot with arrows, especially when the
dataset uses a high dimensional panel.</p>
<p>It is however possible to adjust this threshold by explicitly setting
the <code>arrowThreshold</code> argument. For example, in the below
plot, the threshold is set set to 0.6, showing, for example, that x axis
is also strongly negatively correlated with the median of ‘pS6’ and
‘CD7’ markers.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS</a></span><span class="op">(</span><span class="va">mdsObj</span>,</span>
<span>                pData <span class="op">=</span> <span class="va">phenoData</span>,</span>
<span>                pDataForColour <span class="op">=</span> <span class="st">"group_id"</span>,</span>
<span>                displayPointLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                displayArrowLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                repelArrowLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                biplot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                extVariables <span class="op">=</span> <span class="va">medians</span>,</span>
<span>                arrowThreshold <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMDS_biplot_0.6-1.png" width="700" style="display: block; margin: auto;"></p>
<p>In terms of biological interpretation, since the x axis is the
direction along which there is a clear separation between stimulated and
(reference) un-stimulated samples, the biplot suggests that channels for
which the median appears as strongly correlated with the x axis, should
also show visible distributional difference between the two sample
groups.</p>
<p>In order to check this, we can use the
<code>ggplotMarginalDensities</code> method provided in the
<code>CytoMDS</code> package, as follows:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplotMarginalDensities.html">ggplotMarginalDensities</a></span><span class="op">(</span></span>
<span>    <span class="va">BCRXL_fs_trans</span>, </span>
<span>    channels <span class="op">=</span> <span class="va">chLabels</span>,</span>
<span>    pDataForColour <span class="op">=</span> <span class="st">"group_id"</span>,</span>
<span>    pDataForGroup <span class="op">=</span> <span class="st">"sample_id"</span><span class="op">)</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMarginalDensities-1.png" width="700" style="display: block; margin: auto;">
And indeed, we can notice that the Reference samples (in red) tend to
show higher intensity values for markers ‘pNFkB’, ‘pp38’, ‘CD4’, ‘CD20’,
‘CD33’, ‘pSlp76’, ‘pBtk’, while BCR-XL stimulated samples (in blue) tend
to show higher internsity valeus for markers ‘pS6’, ‘HLA-DR’ and ‘CD7’.
All these markers where identified as strongly (resp. positively and
negatively) correlated with the x axis on the bi-plot.</p>
</div>
<div class="section level4">
<h4 id="bi-plot-wrapping">Bi-plot wrapping<a class="anchor" aria-label="anchor" href="#bi-plot-wrapping"></a>
</h4>
<p>Instead of drawing one single bi-plot related to a specific type of
statistics, for example channel medians as before, we can also try to
associate the axes to different channel statistics at once. In the next
plot, we draw bi-plots for channel medians, 25% and 75% quantiles, and
standard deviations at once.</p>
<p>The ‘facets-alike’ bi-plot, or <em>bi-plot wrapping</em>, is obtained
thanks to the <code><a href="../reference/ggplotSampleMDSWrapBiplots.html">ggplotSampleMDSWrapBiplots()</a></code> function, which
internally calls <code><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS()</a></code> function several times,
and arrange the obtained outputs on a single plot.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">statFUNs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median"</span> <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span>,</span>
<span>             <span class="st">"Q25"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span><span class="op">)</span> <span class="op">{</span></span>
<span>                 <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span>             <span class="op">}</span>,</span>
<span>             <span class="st">"Q75"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span><span class="op">)</span> <span class="op">{</span></span>
<span>                 <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span>             <span class="op">}</span>,</span>
<span>             <span class="st">"standard deviation"</span> <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">)</span></span>
<span><span class="va">chStats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/channelSummaryStats.html">channelSummaryStats</a></span><span class="op">(</span><span class="va">BCRXL_fs_trans</span>,</span>
<span>                               channels <span class="op">=</span> <span class="va">chLabels</span>, </span>
<span>                               statFUNs <span class="op">=</span> <span class="va">statFUNs</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplotSampleMDSWrapBiplots.html">ggplotSampleMDSWrapBiplots</a></span><span class="op">(</span></span>
<span>    <span class="va">mdsObj</span>,</span>
<span>    extVariableList <span class="op">=</span> <span class="va">chStats</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    pData <span class="op">=</span> <span class="va">phenoData</span>,</span>
<span>    pDataForColour <span class="op">=</span> <span class="st">"group_id"</span>,</span>
<span>    displayPointLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    displayArrowLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    repelArrowLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    displayLegend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMDS_biplot_facetting-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Sometimes, as is the case on the plots below, a high number of
channel statistics are strongly correlated with the bi-plot axes, so
that the plot is hardly readable, due to too many arrows displayed.</p>
<p>In that case, it is advised to generate series of bi-plots, part of
the channel statistics, in order to better identify the strongly
correlated ones. One example is provided below, showing the correlation
between the axes and the standard deviation of each channel:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stdDevs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"std dev of channels 1 to 6"</span> <span class="op">=</span> <span class="va">chStats</span><span class="op">[[</span><span class="st">"standard deviation"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>    <span class="st">"std dev of channels 7 to 12"</span> <span class="op">=</span> <span class="va">chStats</span><span class="op">[[</span><span class="st">"standard deviation"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>,</span>
<span>    <span class="st">"std dev of channels 13 to 18"</span> <span class="op">=</span> <span class="va">chStats</span><span class="op">[[</span><span class="st">"standard deviation"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">13</span><span class="op">:</span><span class="fl">18</span><span class="op">]</span>,</span>
<span>    <span class="st">"std dev of channels 19 to 24"</span> <span class="op">=</span> <span class="va">chStats</span><span class="op">[[</span><span class="st">"standard deviation"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">19</span><span class="op">:</span><span class="fl">24</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggplotSampleMDSWrapBiplots.html">ggplotSampleMDSWrapBiplots</a></span><span class="op">(</span></span>
<span>    <span class="va">mdsObj</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    extVariableList <span class="op">=</span> <span class="va">stdDevs</span>,</span>
<span>    pData <span class="op">=</span> <span class="va">phenoData</span>,</span>
<span>    pDataForColour <span class="op">=</span> <span class="st">"group_id"</span>,</span>
<span>    displayPointLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    displayArrowLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    repelArrowLabels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMDS_biplot_stddev-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="handling-large-datasets">Handling large datasets<a class="anchor" aria-label="anchor" href="#handling-large-datasets"></a>
</h2>
<p>Computing Earth Mover’s Distances between all sample pairs of large
datasets (e.g. with hundreds of samples), is a heavy computational
task.</p>
<p>First, loading the whole data set as a
<code><a href="https://rdrr.io/pkg/flowCore/man/flowSet-class.html" class="external-link">flowCore::flowSet()</a></code> in RAM at once, might not be possible
due to its size. Second, calculating a matrix of pairwise distances, has
a computational complexity of O(N2), which can lead to very long
computation times for large datasets.</p>
<p>Therefore, the <code>CytoMDS</code> package provides several
mechanisms allowing to mitigate these issues.</p>
<div class="section level3">
<h3 id="loading-flow-frames-dynamically-during-distance-matrix-computation">Loading flow frames dynamically during distance matrix
computation<a class="anchor" aria-label="anchor" href="#loading-flow-frames-dynamically-during-distance-matrix-computation"></a>
</h3>
<p>In order to be able to handle datasets of greater size than the
available computer RAM, the <code><a href="../reference/pairwiseEMDDist.html">pairwiseEMDDist()</a></code> function
allows for an alternative input mode, where: - the input samples are NOT
provided directly via a <code><a href="https://rdrr.io/pkg/flowCore/man/flowSet-class.html" class="external-link">flowCore::flowSet</a></code>, or<br>
a list of expression matrices, but - the user provides the nb of
samples, and a user-written flow frame loading function that will be
called to dynamically load the <em>i</em>th sample - as an expression
matrix - upon request, and optionally additional arguments.</p>
<p>Typically, the expression matrix loading function provided by the
user shall describe how to read the <em>i</em>th sample from disk.</p>
</div>
<div class="section level3">
<h3 id="using-biocparallel-to-parallelize-distance-matrix-computation">Using BiocParallel to parallelize distance matrix computation<a class="anchor" aria-label="anchor" href="#using-biocparallel-to-parallelize-distance-matrix-computation"></a>
</h3>
<p>Also, <code>CytoMDS</code> pairwise distance calculation supports
parallelization of distance matrix computation, through the use of
<code>BiocParallel</code> package.</p>
<p>When parallelization is used, the calculation engine will
automatically create worker tasks corresponding to the calculation of
blocks of the distance matrix.</p>
<p>In the below, we provide an example with the BodenMiller2012 dataset.
Note that this example has illustrative purpose only, as in fact this
dataset is small enough to fully reside in memory and to not require
parallelization of distance calculation.</p>
<p>In case where ‘on-the-fly’ expression matrices in-memory loading is
required, we advise, as a preliminary step, to store the samples,
previously scale transformed, on disk. Here we do it in a temporary
directory.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">storageLocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nSample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">BCRXL_fs_trans</span><span class="op">)</span></span>
<span><span class="va">fileNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span>
<span>    <span class="va">storageLocation</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"BodenMiller2012_TransformedSample"</span>, </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%02d.rds"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nSample</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nSample</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">BCRXL_fs_trans</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>            file <span class="op">=</span> <span class="va">fileNames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then, the <code><a href="../reference/pairwiseEMDDist.html">pairwiseEMDDist()</a></code> method can be called, now
specifying a number of samples, a expression matrix loading function,
and a <code><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html" class="external-link">BiocParallel::SnowParam()</a></code> backbone for
parallelization of the computations.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu">BiocParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html" class="external-link">SnowParam</a></span><span class="op">(</span></span>
<span>    stop.on.error <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    progressbar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pwDistLast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="../reference/pairwiseEMDDist.html">pairwiseEMDDist</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">nSample</span>,</span>
<span>    channels <span class="op">=</span> <span class="va">chMarkers</span>,</span>
<span>    loadExprMatrixFUN  <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">exprMatrixIndex</span>, <span class="va">files</span>, <span class="va">channels</span>, <span class="va">markers</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">ff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">files</span><span class="op">[</span><span class="va">exprMatrixIndex</span> <span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">exprMat</span> <span class="op">&lt;-</span> <span class="fu">flowCore</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">ff</span><span class="op">)</span><span class="op">[</span>, <span class="va">channels</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exprMat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">markers</span></span>
<span>        <span class="va">exprMat</span></span>
<span>    <span class="op">}</span>,</span>
<span>    loadExprMatrixFUNArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        files <span class="op">=</span> <span class="va">fileNames</span>, </span>
<span>        channels <span class="op">=</span> <span class="va">chLabels</span>,</span>
<span>        markers <span class="op">=</span> <span class="va">chMarkers</span><span class="op">)</span>,</span>
<span>    BPPARAM <span class="op">=</span> <span class="va">bp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   |                                                                              |                                                                      |   0%  |                                                                              |============                                                          |  17%  |                                                                              |=======================                                               |  33%  |                                                                              |===================================                                   |  50%  |                                                                              |===============================================                       |  67%  |                                                                              |==========================================================            |  83%  |                                                                              |======================================================================| 100%</span></span></code></pre>
<p>The obtained distances - as shown in the below histogram - are
exactly the same as before.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distVecLast</span> <span class="op">&lt;-</span> <span class="va">pwDistLast</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">pwDistLast</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">distVecDFLast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">distVecLast</span><span class="op">)</span></span>
<span><span class="va">pHistLast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">distVecDFLast</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkgrey"</span>, col <span class="op">=</span> <span class="st">"black"</span>, bins <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span></span>
<span>        <span class="st">"EMD distances for Bodenmiller2012 dataset"</span>, </span>
<span>        subtitle <span class="op">=</span>  <span class="st">"on the fly memory loading and parallel computation"</span><span class="op">)</span></span>
<span><span class="va">pHistLast</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/dist1ShowHistAgain-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="expression-matrices-as-input-instead-of-flowframes">Expression matrices as input instead of flowFrames<a class="anchor" aria-label="anchor" href="#expression-matrices-as-input-instead-of-flowframes"></a>
</h2>
<p>Standard use of <code>CytoMDS</code> involves providing cytometry
sample data, contained in <code>flowCore</code> standard cytometry data
structures (<code>flowSet</code> and <code>flowFrame</code>) as input to
Earth Mover’s distance calculation.</p>
<p>However, <code>CytoMDS</code> can also accept more generic input
data, as a list of expression matrices, stored in standard R matrices.
For instance, this allows using <code>CytoMDS</code> visualizations for
other type of data than cytometry, as long as each sample can be
represented by a matrix with any number of rows (cells), and fixed
columns/features (markers).</p>
<p>Here below is an illustrating toy example with some randomly
simulated data.</p>
<p>Let us first simulate 10 samples with 1,000 rows each and 10
features. Samples are split into 2 groups: <code>conditionA</code> and
<code>conditionB</code> with some increased expression std deviation for
3 features in <code>conditionB</code>, compared to
<code>conditionA</code>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nSample</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"conditionA"</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"conditionB"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nRow</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">nFeat</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">nDiffFeat</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">diffFeats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">stdDevFactor</span> <span class="op">=</span> <span class="fl">1.5</span></span>
<span></span>
<span><span class="va">exprMatrixList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">nSample</span><span class="op">)</span>,</span>
<span>    <span class="va">conditions</span>,</span>
<span>    FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">condition</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">exprMatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nRow</span><span class="op">*</span><span class="va">nFeat</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">nRow</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">condition</span> <span class="op">==</span> <span class="st">"conditionB"</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">exprMatrix</span><span class="op">[</span>, <span class="va">diffFeats</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exprMatrix</span><span class="op">[</span>, <span class="va">diffFeats</span><span class="op">]</span> <span class="op">*</span> <span class="va">stdDevFactor</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exprMatrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Feat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">nFeat</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">exprMatrix</span></span>
<span>    <span class="op">}</span>,</span>
<span>    SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">exprMatrixList</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sample"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">nSample</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can now generate a pairwise sample distance matrix, based on the
previously simulated matrix list, and show the corresponding
histogram:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwDistExpr</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/pairwiseEMDDist.html">pairwiseEMDDist</a></span><span class="op">(</span></span>
<span>    <span class="va">exprMatrixList</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distVecExpr</span> <span class="op">&lt;-</span> <span class="va">pwDistExpr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">pwDistExpr</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">distVecDFExpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">distVecExpr</span><span class="op">)</span></span>
<span><span class="va">pHistExpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">distVecDFExpr</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkgrey"</span>, col <span class="op">=</span> <span class="st">"black"</span>, bins <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span></span>
<span>        <span class="st">"EMD distances for simulated expression matrices"</span><span class="op">)</span></span>
<span><span class="va">pHistExpr</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/distExprMatShowHist-1.png" width="700" style="display: block; margin: auto;"></p>
<p>With the generated pairwise distance matrix, we can now proceed with
the <code>CytoMDS</code> workflow, as in the previous examples:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mdsObjExpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeMetricMDS.html">computeMetricMDS</a></span><span class="op">(</span><span class="va">pwDistExpr</span>, seed <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">mdsObjExpr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## MDS object containing MDS projection (using Smacof algorithm)  data:</span></span>
<span><span class="co">## Nb of dimensions:  3 </span></span>
<span><span class="co">## Nb of points:  10 </span></span>
<span><span class="co">## Stress:  0.065625 </span></span>
<span><span class="co">## Pseudo RSquare:  0.972289 </span></span>
<span><span class="co">## Goodness of fit:  0.995693</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenoDataExpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sampleId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">nSample</span><span class="op">)</span>, cond <span class="op">=</span> <span class="va">conditions</span><span class="op">)</span></span>
<span><span class="va">p12</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggplotSampleMDS.html">ggplotSampleMDS</a></span><span class="op">(</span></span>
<span>    <span class="va">mdsObjExpr</span>,</span>
<span>    pData <span class="op">=</span> <span class="va">phenoDataExpr</span>,</span>
<span>    projectionAxes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    pDataForColour <span class="op">=</span> <span class="st">"cond"</span>,</span>
<span>    pDataForLabel <span class="op">=</span> <span class="st">"sampleId"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p12</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/plotMDSExprMat-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">statFunctions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span>,</span>
<span>                      std_dev <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">)</span></span>
<span><span class="va">chStatsExpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/channelSummaryStats.html">channelSummaryStats</a></span><span class="op">(</span><span class="va">exprMatrixList</span>,</span>
<span>                                   statFUNs  <span class="op">=</span> <span class="va">statFunctions</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">CytoMDS</span><span class="fu">::</span><span class="fu"><a href="../reference/ggplotSampleMDSWrapBiplots.html">ggplotSampleMDSWrapBiplots</a></span><span class="op">(</span></span>
<span>    mdsObj <span class="op">=</span> <span class="va">mdsObjExpr</span>,</span>
<span>    extVariableList <span class="op">=</span> <span class="va">chStatsExpr</span>,</span>
<span>    pData <span class="op">=</span> <span class="va">phenoDataExpr</span>,</span>
<span>    projectionAxes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    pDataForColour <span class="op">=</span> <span class="st">"cond"</span>,</span>
<span>    displayPointLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    repelArrowLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    arrowThreshold <span class="op">=</span> <span class="fl">0.9</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="CytoMDS_files/figure-html/biplotsMDSExprMat-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<pre><code><span><span class="co">## R Under development (unstable) (2024-11-20 r87352)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 24.04.1 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] patchwork_1.3.0             ggplot2_3.5.1              </span></span>
<span><span class="co">##  [3] CytoMDS_1.3.2               HDCytoData_1.27.0          </span></span>
<span><span class="co">##  [5] flowCore_2.19.0             SummarizedExperiment_1.37.0</span></span>
<span><span class="co">##  [7] Biobase_2.67.0              GenomicRanges_1.59.1       </span></span>
<span><span class="co">##  [9] GenomeInfoDb_1.43.1         IRanges_2.41.1             </span></span>
<span><span class="co">## [11] S4Vectors_0.45.2            MatrixGenerics_1.19.0      </span></span>
<span><span class="co">## [13] matrixStats_1.4.1           ExperimentHub_2.15.0       </span></span>
<span><span class="co">## [15] AnnotationHub_3.15.0        BiocFileCache_2.15.0       </span></span>
<span><span class="co">## [17] dbplyr_2.5.0                BiocGenerics_0.53.3        </span></span>
<span><span class="co">## [19] generics_0.1.3              BiocStyle_2.35.0           </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] splines_4.5.0           filelock_1.0.3          tibble_3.2.1           </span></span>
<span><span class="co">##   [4] polyclip_1.10-7         graph_1.85.0            XML_3.99-0.17          </span></span>
<span><span class="co">##   [7] rpart_4.1.23            lifecycle_1.0.4         doParallel_1.0.17      </span></span>
<span><span class="co">##  [10] flowWorkspace_4.19.0    lattice_0.22-6          MASS_7.3-61            </span></span>
<span><span class="co">##  [13] backports_1.5.0         magrittr_2.0.3          Hmisc_5.2-0            </span></span>
<span><span class="co">##  [16] sass_0.4.9              rmarkdown_2.29          jquerylib_0.1.4        </span></span>
<span><span class="co">##  [19] yaml_2.3.10             plotrix_3.8-4           DBI_1.2.3              </span></span>
<span><span class="co">##  [22] minqa_1.2.8             RColorBrewer_1.1-3      abind_1.4-8            </span></span>
<span><span class="co">##  [25] zlibbioc_1.53.0         ggcyto_1.35.0           purrr_1.0.2            </span></span>
<span><span class="co">##  [28] nnet_7.3-19             pracma_2.4.4            tweenr_2.0.3           </span></span>
<span><span class="co">##  [31] rappdirs_0.3.3          transport_0.15-4        GenomeInfoDbData_1.2.13</span></span>
<span><span class="co">##  [34] ggrepel_0.9.6           gdata_3.0.1             ellipse_0.5.0          </span></span>
<span><span class="co">##  [37] pkgdown_2.1.1.9000      codetools_0.2-20        DelayedArray_0.33.2    </span></span>
<span><span class="co">##  [40] ggforce_0.4.2           tidyselect_1.2.1        shape_1.4.6.1          </span></span>
<span><span class="co">##  [43] UCSC.utils_1.3.0        farver_2.1.2            lme4_1.1-35.5          </span></span>
<span><span class="co">##  [46] base64enc_0.1-3         jsonlite_1.8.9          e1071_1.7-16           </span></span>
<span><span class="co">##  [49] mitml_0.4-5             Formula_1.2-5           survival_3.7-0         </span></span>
<span><span class="co">##  [52] iterators_1.0.14        systemfonts_1.1.0       foreach_1.5.2          </span></span>
<span><span class="co">##  [55] tools_4.5.0             ragg_1.3.3              snow_0.4-4             </span></span>
<span><span class="co">##  [58] Rcpp_1.0.13-1           glue_1.8.0              gridExtra_2.3          </span></span>
<span><span class="co">##  [61] pan_1.9                 SparseArray_1.7.2       xfun_0.49              </span></span>
<span><span class="co">##  [64] dplyr_1.1.4             withr_3.0.2             BiocManager_1.30.25    </span></span>
<span><span class="co">##  [67] fastmap_1.2.0           boot_1.3-31             fansi_1.0.6            </span></span>
<span><span class="co">##  [70] digest_0.6.37           R6_2.5.1                mime_0.12              </span></span>
<span><span class="co">##  [73] mice_3.16.0             textshaping_0.4.0       colorspace_2.1-1       </span></span>
<span><span class="co">##  [76] gtools_3.9.5            RSQLite_2.3.8           weights_1.0.4          </span></span>
<span><span class="co">##  [79] utf8_1.2.4              tidyr_1.3.1             hexbin_1.28.5          </span></span>
<span><span class="co">##  [82] data.table_1.16.2       class_7.3-22            httr_1.4.7             </span></span>
<span><span class="co">##  [85] htmlwidgets_1.6.4       S4Arrays_1.7.1          pkgconfig_2.0.3        </span></span>
<span><span class="co">##  [88] gtable_0.3.6            blob_1.2.4              RProtoBufLib_2.19.0    </span></span>
<span><span class="co">##  [91] XVector_0.47.0          htmltools_0.5.8.1       bookdown_0.41          </span></span>
<span><span class="co">##  [94] scales_1.3.0            png_0.1-8               wordcloud_2.6          </span></span>
<span><span class="co">##  [97] knitr_1.49              rstudioapi_0.17.1       reshape2_1.4.4         </span></span>
<span><span class="co">## [100] checkmate_2.3.2         nlme_3.1-166            curl_6.0.1             </span></span>
<span><span class="co">## [103] nloptr_2.1.1            proxy_0.4-27            cachem_1.1.0           </span></span>
<span><span class="co">## [106] stringr_1.5.1           BiocVersion_3.21.1      parallel_4.5.0         </span></span>
<span><span class="co">## [109] foreign_0.8-87          AnnotationDbi_1.69.0    desc_1.4.3             </span></span>
<span><span class="co">## [112] pillar_1.9.0            grid_4.5.0              vctrs_0.6.5            </span></span>
<span><span class="co">## [115] cytolib_2.19.0          jomo_2.7-6              cluster_2.1.6          </span></span>
<span><span class="co">## [118] htmlTable_2.4.3         Rgraphviz_2.51.0        evaluate_1.0.1         </span></span>
<span><span class="co">## [121] cli_3.6.3               compiler_4.5.0          rlang_1.1.4            </span></span>
<span><span class="co">## [124] crayon_1.5.3            smacof_2.1-7            ncdfFlow_2.53.0        </span></span>
<span><span class="co">## [127] labeling_0.4.3          plyr_1.8.9              fs_1.6.5               </span></span>
<span><span class="co">## [130] stringi_1.8.4           BiocParallel_1.41.0     nnls_1.6               </span></span>
<span><span class="co">## [133] munsell_0.5.1           Biostrings_2.75.1       glmnet_4.1-8           </span></span>
<span><span class="co">## [136] Matrix_1.7-1            bit64_4.5.2             CytoPipeline_1.7.0     </span></span>
<span><span class="co">## [139] KEGGREST_1.47.0         broom_1.0.7             memoise_2.0.1          </span></span>
<span><span class="co">## [142] bslib_0.8.0             bit_4.5.0               polynom_1.4-1</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Bodenmiller2012-re" class="csl-entry">
Bodenmiller, Bernd, Eli R Zunder, Rachel Finck, Tiffany J Chen, Erica S
Savig, Robert V Bruggner, Erin F Simonds, et al. 2012.
<span>“Multiplexed Mass Cytometry Profiling of Cellular States Perturbed
by Small-Molecule Regulators.”</span> <em>Nat. Biotechnol.</em> 30 (9):
858–67.
</div>
<div id="ref-flowCore" class="csl-entry">
Ellis, B, Perry Haaland, Florian Hahne, Nolwenn Le Meur, Nishant
Gopalakrishnan, Josef Spidlen, Mike Jiang, and Greg Finak. 2023.
<em>flowCore: flowCore: Basic Structures for Flow Cytometry Data</em>.
<a href="https://doi.org/10.18129/B9.bioc.flowCore" class="external-link">https://doi.org/10.18129/B9.bioc.flowCore</a>.
</div>
<div id="ref-De_Leeuw2009-aw" class="csl-entry">
Leeuw, Jan de, and Patrick Mair. 2009. <span>“Multidimensional Scaling
Using Majorization: <span>SMACOF</span> in <span>R</span>.”</span>
<em>J. Stat. Softw.</em> 31 (August): 1–30.
</div>
<div id="ref-Nowicka2017-dh" class="csl-entry">
Nowicka, Malgorzata, Carsten Krieg, Helena L Crowell, Lukas M Weber,
Felix J Hartmann, Silvia Guglietta, Burkhard Becher, Mitchell P
Levesque, and Mark D Robinson. 2017. <span>“<span>CyTOF</span> Workflow:
Differential Discovery in High-Throughput High-Dimensional Cytometry
Datasets.”</span> <em>F1000Res.</em> 6 (May): 748.
</div>
<div id="ref-Orlova2016-jm" class="csl-entry">
Orlova, Darya Y, Noah Zimmerman, Stephen Meehan, Connor Meehan, Jeffrey
Waters, Eliver E B Ghosn, Alexander Filatenkov, et al. 2016.
<span>“Earth Mover’s Distance (<span>EMD)</span>: A True Metric for
Comparing Biomarker Expression Levels in Cell Populations.”</span>
<em>PLOS ONE</em>.
</div>
<div id="ref-Weber2019-pz" class="csl-entry">
Weber, Lukas M, Malgorzata Nowicka, Charlotte Soneson, and Mark D
Robinson. 2019. <span>“Diffcyt: Differential Discovery in
High-Dimensional Cytometry via High-Resolution Clustering.”</span>
<em>Commun Biol</em> 2 (May): 183.
</div>
<div id="ref-Weber2019-qp" class="csl-entry">
Weber, Lukas M, and Charlotte Soneson. 2019.
<span>“<span>HDCytoData</span>: Collection of High-Dimensional Cytometry
Benchmark Datasets in Bioconductor Object Formats.”</span>
<em>F1000Res.</em> 8 (August): 1459.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philippe Hauchamps, Laurent Gatto.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
